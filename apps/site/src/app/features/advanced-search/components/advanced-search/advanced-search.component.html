<div class="container" libPerfectScrollbar>
  <h5>
    Расширенный поиск
    <small
      ><a [routerLink]="['/books']" class="underline">обычный поиск</a></small
    >
  </h5>

  <form [formGroup]="form" (submit)="submit($event)">
    <section>
      <span class="header">Режим поиска:</span>
      <label
        ><input type="radio" formControlName="mode" value="and" />"И" (каждое
        условие)</label
      >
      <label
        ><input type="radio" formControlName="mode" value="or" />"ИЛИ (хотя бы
        одно из условий)</label
      >
      <button mat-fab extended="true" color="success" type="submit">
        <mat-icon>search</mat-icon>
        Искать
      </button>
    </section>

    <section class="parameter-grid">
      <span>Рейтинг не ниже чем:</span>
      <input type="text" formControlName="rating" />
      <span>(из 10)</span>
    </section>

    <details #genresContainer>
      <summary>Жанры</summary>
      <section libPerfectScrollbar class="genres-grid">
        @for (group of Object.keys(FB_GENRES_TRANSLATED_STRUCTURED); track
        group) {
        {{ group }}<br />
        @if (FB_GENRES_TRANSLATED_STRUCTURED[group].length) {
        <div class="group">
          @for (genre of $any(FB_GENRES_TRANSLATED_STRUCTURED[group]); track
          genre) {
          <label>
            <input
              type="checkbox"
              [formControlName]="FB2_GENRES_KEY_VALUE_SWAPPED[genre]"
            />
            <span>{{ genre }}</span>
          </label>
          }
        </div>
        } @else { @for (subGroup of
        Object.keys(FB_GENRES_TRANSLATED_STRUCTURED[group]); track subGroup) {
        <div class="group">
          {{ subGroup }}
          <div class="group">
            @for (genre of
            $any(FB_GENRES_TRANSLATED_STRUCTURED[group])[subGroup]; track genre)
            {
            <label>
              <input
                type="checkbox"
                [formControlName]="FB2_GENRES_KEY_VALUE_SWAPPED[genre]"
              />
              <span>{{ genre }}</span>
            </label>
            }
          </div>
        </div>
        } } }
      </section>
    </details>

    <div class="action-panel">
      <button mat-fab extended="true" color="success" type="submit">
        <mat-icon>search</mat-icon>
        Искать
      </button>
    </div>
  </form>

  <div #searchResult class="search-result">
    @if (data()) { @if (data()!.length === 0) {
    <span>По вашему запросы книги не найдены</span>
    }
    <div libPerfectScrollbar class="grid books-grid">
      @for (item of data(); track item.id){
      <nav>
        <lib-tag-link [value]="item.id" linkPrefix="/book">
          {{ item.full }}
        </lib-tag-link>
      </nav>
      }
    </div>
    }
  </div>
  @if (error()) {
  <span>Ошибка: {{ error() | json }}</span>
  }
</div>
